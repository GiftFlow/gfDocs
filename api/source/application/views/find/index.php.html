<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="generator" content="PHPDoctor 2RC4 (http://peej.github.com/phpdoctor/)">
<meta name="when" content="Sun, 20 Jun 2010 17:43:51 +0000">

<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css">
<link rel="start" href="../../../../overview-summary.html">

<title>application/views/find/index.php (GiftFlow API)</title>

</head>
<body id="file" onload="parent.document.title=document.title;">

<div class="header">
<h1>GiftFlow API</h1>
<ul>
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li>Package</li><li>Class</li><li>Tree</li><li><a href="../../../../overview-files.html">Files</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
</ul>
</div>

<div class="small_links">
<a href="../../../../index.html" target="_top">Frames</a>
<a href="../../../../source/application/views/find/index.php.html" target="_top">No frames</a>
</div>
<hr>

<h1>application/views/find/index.php</h1>
<hr>

<a name="line1"></a><pre><div id='find'>
<a name="line2"></a><img src='<?php echo base_url(); ?>assets/images/headings/find.png' id='heading_find' />
<a name="line3"></a><form method='post' id='find_search'>
<a name="line4"></a><table class='search'>
<a name="line5"></a>	<tr>
<a name="line6"></a>		<td><label>What?</label></td>
<a name="line7"></a>		<td><label>Where?</label></td>
<a name="line8"></a>		<td></td>
<a name="line9"></a>	</tr>
<a name="line10"></a>	<tr>
<a name="line11"></a>		<td><input name='what' type='text' id='find_what' value="<?php if(!empty($keyword)) echo urldecode($keyword); ?>" /></td>
<a name="line12"></a>		<td>
<a name="line13"></a>			<input name='where' type='text' id='find_where' value='<?php if(!empty($location['address']) ) echo $location['address']; ?>' />
<a name="line14"></a>			<input type='hidden' name='latitude' value='<?php if( !empty( $location['latitude'] ) ) echo $location['latitude']; ?>' id='latitude' />
<a name="line15"></a>			<input type='hidden' name='longitude' value='<?php if( !empty( $location['longitude'] ) ) echo $location['longitude']; ?>' id='longitude' />
<a name="line16"></a>			<input type='hidden' name='address' value='<?php if( !empty( $location['address'] ) ) echo $location['address']; ?>' id='address' />
<a name="line17"></a>		</td>
<a name="line18"></a>		<td><input type='submit' id='find_submit' style='width: 110px;' value='Find It' /></td>
<a name="line19"></a>	</tr>
<a name="line20"></a></table>
<a name="line21"></a></form>
<a name="line22"></a></div>
<a name="line23"></a><div id='find_content'>
<a name="line24"></a>
<a name="line25"></a>
<a name="line26"></a>	<!-- Tags -->
<a name="line27"></a>	
<a name="line28"></a>	<?php if( $display == 'tags' ) { ?>
<a name="line29"></a>	<div id='find_tags'>
<a name="line30"></a>		<h2 style='font-weight: 300;'>Popular Tags</h2>
<a name="line31"></a>		<?php
<a name="line32"></a>		$i=0;
<a name="line33"></a>		foreach($tags as $obj) 
<a name="line34"></a>		{
<a name="line35"></a>			if ( $i<25)
<a name="line36"></a>			echo "<a rel='".$i."' href='".site_url('find/'.urlencode($obj->tag))."' class='tag'>".$obj->tag."</a>";
<a name="line37"></a>			$i++;
<a name="line38"></a>		}
<a name="line39"></a>		?>
<a name="line40"></a>	</div>
<a name="line41"></a>	<?php } ?>
<a name="line42"></a>	
<a name="line43"></a>	<!-- Google Map -->
<a name="line44"></a>	<div id='find_map'>
<a name="line45"></a>	</div>
<a name="line46"></a>	
<a name="line47"></a>	<!-- Search Results -->
<a name="line48"></a>	<div id='find_results'>
<a name="line49"></a>	<div class='no_results <?php if( $display != 'no_results' ) { echo "hidden"; } ?>'>
<a name="line50"></a>		<h2>Oops!</h2>
<a name="line51"></a>		<p>No results found. You should check out some of the site's most popular tags:</p>
<a name="line52"></a>	<div id='find_tags'>
<a name="line53"></a>		<?php
<a name="line54"></a>		$i=0;
<a name="line55"></a>		foreach($tags as $obj) 
<a name="line56"></a>		{
<a name="line57"></a>			if ( $i<10)
<a name="line58"></a>			echo "<a rel='".$i."' href='".site_url('find/'.urlencode($obj->tag))."' class='tag'>".$obj->tag."</a>";
<a name="line59"></a>			$i++;
<a name="line60"></a>		}
<a name="line61"></a>		?>
<a name="line62"></a>	</div>
<a name="line63"></a>
<a name="line64"></a>	</div>
<a name="line65"></a>	<?php 		
<a name="line66"></a>	if( $display == 'results' )
<a name="line67"></a>	{
<a name="line68"></a>		echo "<ul class='results_list'>";
<a name="line69"></a>		foreach($results as $obj) 
<a name="line70"></a>		{ 
<a name="line71"></a>			echo $obj->html;  
<a name="line72"></a>		} 
<a name="line73"></a>		echo "</ul>";
<a name="line74"></a>	}
<a name="line75"></a>	else
<a name="line76"></a>	{
<a name="line77"></a>		echo "<ul class='results_list' style='display: none;'></ul>";
<a name="line78"></a>	}
<a name="line79"></a>	?>
<a name="line80"></a>	</div>
<a name="line81"></a></div>
<a name="line82"></a><script>
<a name="line83"></a>$(function(){	
<a name="line84"></a>	$("input:submit").button();
<a name="line85"></a>	/*
<a name="line86"></a>	*	Define initial variables
<a name="line87"></a>	*/
<a name="line88"></a>	// define map
<a name="line89"></a>	var map;
<a name="line90"></a>	
<a name="line91"></a>	// define location of gift icon
<a name="line92"></a>	var giftIcon = '<?php echo base_url(); ?>assets/images/icon_gift.png';
<a name="line93"></a>   		 
<a name="line94"></a>	// Write preloaded data
<a name="line95"></a>	var dataset = { <?php if(!empty($location)) { ?>
<a name="line96"></a>					"center": { 
<a name="line97"></a>								"address":"<?php if(!empty($location['address'])) echo $location['address']; ?>", 
<a name="line98"></a>								"latitude":"<?php if(!empty($location['latitude'])) echo $location['latitude']; ?>", 
<a name="line99"></a>								"longitude":"<?php if(!empty($location['longitude'])) echo $location['longitude']; ?>"
<a name="line100"></a>								},
<a name="line101"></a>					<?php } ?>
<a name="line102"></a>					"results": [ <?php if(!empty($results)) {
<a name="line103"></a>									for($i=0; $i<count($results); $i++)
<a name="line104"></a>									{
<a name="line105"></a>										echo "{ 'latitude':'".$results[$i]->latitude."', 'longitude':'".$results[$i]->longitude."','title':'".$results[$i]->title."'}";
<a name="line106"></a>										if($i!=(count($results)-1)) echo ",\n";
<a name="line107"></a>									}
<a name="line108"></a>								}
<a name="line109"></a>								?>]};
<a name="line110"></a>	
<a name="line111"></a>	// Process preloaded data
<a name="line112"></a>	if(dataset.results.length>0)
<a name="line113"></a>		generateCenteredMap(dataset);
<a name="line114"></a>	else
<a name="line115"></a>	{
<a name="line116"></a>	}
<a name="line117"></a>		
<a name="line118"></a>		
<a name="line119"></a>	// Ajaxify the form
<a name="line120"></a>	var formOptions = { 	
<a name="line121"></a>							success: processAjax,
<a name="line122"></a>							url: '<?php echo site_url("ajax/gift_search");?>',
<a name="line123"></a>							dataType: 'json'
<a name="line124"></a>						};
<a name="line125"></a>	$("#find_search").ajaxForm(formOptions);
<a name="line126"></a>	
<a name="line127"></a>	/*
<a name="line128"></a>	*	Process the AJAX data returned by the form.
<a name="line129"></a>	*/
<a name="line130"></a>	function processAjax( data )
<a name="line131"></a>	{
<a name="line132"></a>   		// If there are results...
<a name="line133"></a>		if(data.results[0]!=null)
<a name="line134"></a>		{
<a name="line135"></a>			// Display search results
<a name="line136"></a>			$(".results_list").empty().show();
<a name="line137"></a>			$.each(data.results, function( key, val){
<a name="line138"></a>				$(".results_list").append($(val.html));
<a name="line139"></a>			});
<a name="line140"></a>			paginate();
<a name="line141"></a>			generateCenteredMap( data );
<a name="line142"></a>		}
<a name="line143"></a>		// If there are no results
<a name="line144"></a>		else
<a name="line145"></a>		{
<a name="line146"></a>			$("ul.simplePagerNav").remove();
<a name="line147"></a>			generateCenteredMap( data );
<a name="line148"></a>			$(".results_list").hide();
<a name="line149"></a>			$(".no_results").show();
<a name="line150"></a>		}
<a name="line151"></a>	}
<a name="line152"></a>
<a name="line153"></a>	function generateCenteredMap( data )
<a name="line154"></a>	{
<a name="line155"></a>		$("#find_map").show();
<a name="line156"></a>		$(".no_results").hide();
<a name="line157"></a>		
<a name="line158"></a>		/*
<a name="line159"></a>		*	 Sets the center of the map. There are 3 cases.
<a name="line160"></a>		*	1. center is defined in the json's center property
<a name="line161"></a>		*	2. location of first result is used as the center
<a name="line162"></a>		*	3. location is set to be new haven
<a name="line163"></a>		*/
<a name="line164"></a>		if(data.center!=null)
<a name="line165"></a>			var default_location = new google.maps.LatLng( data.center.latitude, data.center.longitude );
<a name="line166"></a>		else if(data.results[0]!=null)
<a name="line167"></a>			var default_location = new google.maps.LatLng( data.results[0].latitude, data.results[0].longitude );
<a name="line168"></a>		else
<a name="line169"></a>			var default_location = new google.maps.LatLng( 41, -71);
<a name="line170"></a>		
<a name="line171"></a>		// Options
<a name="line172"></a>		var mapOptions = {
<a name="line173"></a>			scrollwheel: false,
<a name="line174"></a>     			zoom: 12,
<a name="line175"></a>     			center: default_location,
<a name="line176"></a>			mapTypeId: google.maps.MapTypeId.ROADMAP,
<a name="line177"></a>			mapTypeControl: false,
<a name="line178"></a>			navigationControlOptions:  {
<a name="line179"></a>				style: google.maps.NavigationControlStyle.SMALL
<a name="line180"></a> 			}
<a name="line181"></a>   		 };
<a name="line182"></a>   		
<a name="line183"></a>   		// Create new map element
<a name="line184"></a>		map = new google.maps.Map(document.getElementById("find_map"), mapOptions);
<a name="line185"></a>		
<a name="line186"></a>		/*
<a name="line187"></a>		*	important: ensures that the event listener that is about to be created doesn't fire every time
<a name="line188"></a>		*	the map is reloaded
<a name="line189"></a>		*/
<a name="line190"></a>		var init = 0;
<a name="line191"></a>		
<a name="line192"></a>		/*
<a name="line193"></a>		*	When the tiles are finished loading, the markers are added. The getBounds function
<a name="line194"></a>		*	will not work properly unless this is the case. The if condition makes sure that the 
<a name="line195"></a>		*	event listener doesn't fire every time the map is moved or zoomed.
<a name="line196"></a>		*/
<a name="line197"></a>		google.maps.event.addListener(map, 'tilesloaded', function () 
<a name="line198"></a>		{
<a name="line199"></a>			if(init==0)
<a name="line200"></a>			{
<a name="line201"></a>				init =1
<a name="line202"></a>				// Add center marker
<a name="line203"></a>				if(data.center!=null)
<a name="line204"></a>					add_marker( null, null, 'Your Location', null, default_location);
<a name="line205"></a>		
<a name="line206"></a>				// Add gift markers
<a name="line207"></a>				$.each(data.results, function(key, val){
<a name="line208"></a>					add_marker(val.latitude, val.longitude, val.title, giftIcon);
<a name="line209"></a>				});		
<a name="line210"></a>			}
<a name="line211"></a>		});
<a name="line212"></a>	}
<a name="line213"></a>
<a name="line214"></a>	function add_marker( latitude, longitude, title, icon, location_obj )
<a name="line215"></a>	{
<a name="line216"></a>		if(location_obj!=null)
<a name="line217"></a>		{
<a name="line218"></a>			location = location_obj;
<a name="line219"></a>		}
<a name="line220"></a>		else
<a name="line221"></a>		{
<a name="line222"></a>			// marker location
<a name="line223"></a>			var location = new google.maps.LatLng( latitude, longitude);
<a name="line224"></a>		}
<a name="line225"></a>		
<a name="line226"></a>		// zooms out until marker is visible
<a name="line227"></a>		expander( location );
<a name="line228"></a>		
<a name="line229"></a>		// create marker
<a name="line230"></a>		var marker = new google.maps.Marker({
<a name="line231"></a>			position: location, 
<a name="line232"></a>			map: map, 
<a name="line233"></a>			icon: icon,
<a name="line234"></a>			title: title
<a name="line235"></a>		});
<a name="line236"></a>	}
<a name="line237"></a>	
<a name="line238"></a>	/*
<a name="line239"></a>	*	function recursively expands the bounds to include markers,
<a name="line240"></a>	*	while ensuring that the map is still centered on the user's location.
<a name="line241"></a>	*/
<a name="line242"></a>	function expander( location )
<a name="line243"></a>	{
<a name="line244"></a>		var boundaries = map.getBounds();
<a name="line245"></a>		var fits = boundaries.contains( location );
<a name="line246"></a>		if(fits == false)
<a name="line247"></a>		{
<a name="line248"></a>			var zoom = map.getZoom();
<a name="line249"></a>			map.setZoom(zoom-1);
<a name="line250"></a>			expander(location);
<a name="line251"></a>		}
<a name="line252"></a>		else
<a name="line253"></a>		{
<a name="line254"></a>			return true;
<a name="line255"></a>		}
<a name="line256"></a>	}
<a name="line257"></a>	
<a name="line258"></a>	<?php if($display=="no_results"&&(!empty($location['latitude'])&&!empty($location['longitude']))) { ?>
<a name="line259"></a>		var data = <?php $data['center'] = $location; $data['results'] = ''; echo json_encode($data); ?>;
<a name="line260"></a>		generateCenteredMap(data);
<a name="line261"></a>		$(".no_results").show();
<a name="line262"></a>	<?php } ?>
<a name="line263"></a>
<a name="line264"></a>	paginate();
<a name="line265"></a>	
<a name="line266"></a>	function paginate()
<a name="line267"></a>	{
<a name="line268"></a>		$("ul.simplePagerNav").remove();
<a name="line269"></a>		$("ul.results_list").quickPager( { pageSize: 5} );
<a name="line270"></a>	}
<a name="line271"></a>});
<a name="line272"></a>
<a name="line273"></a></script></pre>
<div class="header">
<h1>GiftFlow API</h1>
<ul>
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li>Package</li><li>Class</li><li>Tree</li><li><a href="../../../../overview-files.html">Files</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
</ul>
</div>

<div class="small_links">
<a href="../../../../index.html" target="_top">Frames</a>
<a href="../../../../source/application/views/find/index.php.html" target="_top">No frames</a>
</div>
<hr>

<p id="footer">This document was generated by <a href="http://peej.github.com/phpdoctor/">PHPDoctor: The PHP Documentation Creator</a></p>

</body>

</html>