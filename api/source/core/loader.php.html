<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="generator" content="PHPDoctor 2RC4 (http://peej.github.com/phpdoctor/)">
<meta name="when" content="Sat, 24 Jul 2010 20:46:31 +0000">

<link rel="stylesheet" type="text/css" href="../../stylesheet.css">
<link rel="start" href="../../overview-summary.html">

<title>core/Loader.php (GiftFlow API)</title>

</head>
<body id="file" onload="parent.document.title=document.title;">

<div class="header">
<h1>GiftFlow API</h1>
<ul>
<li><a href="../../overview-summary.html">Overview</a></li>
<li>Package</li><li>Class</li><li>Tree</li><li><a href="../../overview-files.html">Files</a></li>
<li><a href="../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../index-all.html">Index</a></li>
</ul>
</div>

<div class="small_links">
<a href="../../index.html" target="_top">Frames</a>
<a href="../../source/core/loader.php.html" target="_top">No frames</a>
</div>
<hr>

<h1>core/Loader.php</h1>
<div class="comment" id="overview_description"><p>CodeIgniter</p><p>An open source application development framework for PHP 4.3.2 or newer</p></div>

<hr>

<a name="line1"></a><pre><?php  if ( ! defined('BASEPATH')) exit('No direct script access allowed');
<a name="line2"></a>/**
<a name="line3"></a> * CodeIgniter
<a name="line4"></a> *
<a name="line5"></a> * An open source application development framework for PHP 4.3.2 or newer
<a name="line6"></a> *
<a name="line7"></a> * @package		CodeIgniter
<a name="line8"></a> * @author		ExpressionEngine Dev Team
<a name="line9"></a> * @copyright	Copyright (c) 2008 - 2010, EllisLab, Inc.
<a name="line10"></a> * @license		http://codeigniter.com/user_guide/license.html
<a name="line11"></a> * @link		http://codeigniter.com
<a name="line12"></a> * @since		Version 1.0
<a name="line13"></a> * @filesource
<a name="line14"></a> */
<a name="line15"></a>
<a name="line16"></a>// ------------------------------------------------------------------------
<a name="line17"></a>
<a name="line18"></a>/**
<a name="line19"></a> * Loader Class
<a name="line20"></a> *
<a name="line21"></a> * Loads views and files
<a name="line22"></a> *
<a name="line23"></a> * @package		CodeIgniter
<a name="line24"></a> * @subpackage	Libraries
<a name="line25"></a> * @author		ExpressionEngine Dev Team
<a name="line26"></a> * @category	Loader
<a name="line27"></a> * @link		http://codeigniter.com/user_guide/libraries/loader.html
<a name="line28"></a> */
<a name="line29"></a>class CI_Loader {
<a name="line30"></a>
<a name="line31"></a>	// All these are set automatically. Don't mess with them.
<a name="line32"></a>	var $_ci_ob_level;
<a name="line33"></a>	var $_ci_view_path		= '';
<a name="line34"></a>	var $_ci_library_paths	= array();
<a name="line35"></a>	var $_ci_model_paths	= array();
<a name="line36"></a>	var $_ci_helper_paths	= array();
<a name="line37"></a>	var $_ci_is_instance 	= FALSE; // Whether we should use $this or $CI =& get_instance()
<a name="line38"></a>	var $_base_classes		= array(); // Set by the controller class
<a name="line39"></a>	var $_ci_cached_vars	= array();
<a name="line40"></a>	var $_ci_classes		= array();
<a name="line41"></a>	var $_ci_loaded_files	= array();
<a name="line42"></a>	var $_ci_models			= array();
<a name="line43"></a>	var $_ci_helpers		= array();
<a name="line44"></a>	var $_ci_varmap			= array('unit_test' => 'unit', 'user_agent' => 'agent');
<a name="line45"></a>	
<a name="line46"></a>
<a name="line47"></a>	/**
<a name="line48"></a>	 * Constructor
<a name="line49"></a>	 *
<a name="line50"></a>	 * Sets the path to the view files and gets the initial output buffering level
<a name="line51"></a>	 *
<a name="line52"></a>	 * @access	public
<a name="line53"></a>	 */
<a name="line54"></a>	function CI_Loader()
<a name="line55"></a>	{	
<a name="line56"></a>		$this->_ci_view_path = APPPATH.'views/';
<a name="line57"></a>		$this->_ci_ob_level  = ob_get_level();
<a name="line58"></a>		$this->_ci_library_paths = array(APPPATH, BASEPATH);
<a name="line59"></a>		$this->_ci_helper_paths = array(APPPATH, BASEPATH);
<a name="line60"></a>		$this->_ci_model_paths = array(APPPATH);
<a name="line61"></a>			
<a name="line62"></a>		log_message('debug', "Loader Class Initialized");
<a name="line63"></a>	}
<a name="line64"></a>	
<a name="line65"></a>	// --------------------------------------------------------------------
<a name="line66"></a>	
<a name="line67"></a>	/**
<a name="line68"></a>	 * Class Loader
<a name="line69"></a>	 *
<a name="line70"></a>	 * This function lets users load and instantiate classes.
<a name="line71"></a>	 * It is designed to be called from a user's app controllers.
<a name="line72"></a>	 *
<a name="line73"></a>	 * @access	public
<a name="line74"></a>	 * @param	string	the name of the class
<a name="line75"></a>	 * @param	mixed	the optional parameters
<a name="line76"></a>	 * @param	string	an optional object name
<a name="line77"></a>	 * @return	void
<a name="line78"></a>	 */	
<a name="line79"></a>	function library($library = '', $params = NULL, $object_name = NULL)
<a name="line80"></a>	{
<a name="line81"></a>		if ($library == '' OR isset($this->_base_classes[$library]))
<a name="line82"></a>		{
<a name="line83"></a>			return FALSE;
<a name="line84"></a>		}
<a name="line85"></a>
<a name="line86"></a>		if ( ! is_null($params) && ! is_array($params))
<a name="line87"></a>		{
<a name="line88"></a>			$params = NULL;
<a name="line89"></a>		}
<a name="line90"></a>
<a name="line91"></a>		if (is_array($library))
<a name="line92"></a>		{
<a name="line93"></a>			foreach ($library as $class)
<a name="line94"></a>			{
<a name="line95"></a>				$this->_ci_load_class($class, $params, $object_name);
<a name="line96"></a>			}
<a name="line97"></a>		}
<a name="line98"></a>		else
<a name="line99"></a>		{
<a name="line100"></a>			$this->_ci_load_class($library, $params, $object_name);
<a name="line101"></a>		}
<a name="line102"></a>		
<a name="line103"></a>		$this->_ci_assign_to_models();
<a name="line104"></a>	}
<a name="line105"></a>
<a name="line106"></a>	// --------------------------------------------------------------------
<a name="line107"></a>	
<a name="line108"></a>	/**
<a name="line109"></a>	 * Model Loader
<a name="line110"></a>	 *
<a name="line111"></a>	 * This function lets users load and instantiate models.
<a name="line112"></a>	 *
<a name="line113"></a>	 * @access	public
<a name="line114"></a>	 * @param	string	the name of the class
<a name="line115"></a>	 * @param	string	name for the model
<a name="line116"></a>	 * @param	bool	database connection
<a name="line117"></a>	 * @return	void
<a name="line118"></a>	 */	
<a name="line119"></a>	function model($model, $name = '', $db_conn = FALSE)
<a name="line120"></a>	{		
<a name="line121"></a>		if (is_array($model))
<a name="line122"></a>		{
<a name="line123"></a>			foreach($model as $babe)
<a name="line124"></a>			{
<a name="line125"></a>				$this->model($babe);	
<a name="line126"></a>			}
<a name="line127"></a>			return;
<a name="line128"></a>		}
<a name="line129"></a>
<a name="line130"></a>		if ($model == '')
<a name="line131"></a>		{
<a name="line132"></a>			return;
<a name="line133"></a>		}
<a name="line134"></a>	
<a name="line135"></a>		$path = '';
<a name="line136"></a>	
<a name="line137"></a>		// Is the model in a sub-folder? If so, parse out the filename and path.
<a name="line138"></a>		if (($last_slash = strrpos($model, '/')) !== FALSE)
<a name="line139"></a>		{
<a name="line140"></a>			// The path is in front of the last slash
<a name="line141"></a>			$path = substr($model, 0, $last_slash + 1);
<a name="line142"></a>
<a name="line143"></a>			// And the model name behind it
<a name="line144"></a>			$model = substr($model, $last_slash + 1);
<a name="line145"></a>		}
<a name="line146"></a>	
<a name="line147"></a>		if ($name == '')
<a name="line148"></a>		{
<a name="line149"></a>			$name = $model;
<a name="line150"></a>		}
<a name="line151"></a>		
<a name="line152"></a>		if (in_array($name, $this->_ci_models, TRUE))
<a name="line153"></a>		{
<a name="line154"></a>			return;
<a name="line155"></a>		}
<a name="line156"></a>		
<a name="line157"></a>		$CI =& get_instance();
<a name="line158"></a>		if (isset($CI->$name))
<a name="line159"></a>		{
<a name="line160"></a>			show_error('The model name you are loading is the name of a resource that is already being used: '.$name);
<a name="line161"></a>		}
<a name="line162"></a>	
<a name="line163"></a>		$model = strtolower($model);
<a name="line164"></a>
<a name="line165"></a>		foreach ($this->_ci_model_paths as $mod_path)
<a name="line166"></a>		{
<a name="line167"></a>			if ( ! file_exists($mod_path.'models/'.$path.$model.EXT))
<a name="line168"></a>			{
<a name="line169"></a>				continue;
<a name="line170"></a>			}
<a name="line171"></a>
<a name="line172"></a>			if ($db_conn !== FALSE AND ! class_exists('CI_DB'))
<a name="line173"></a>			{
<a name="line174"></a>				if ($db_conn === TRUE)
<a name="line175"></a>					$db_conn = '';
<a name="line176"></a>
<a name="line177"></a>				$CI->load->database($db_conn, FALSE, TRUE);
<a name="line178"></a>			}
<a name="line179"></a>
<a name="line180"></a>			if ( ! class_exists('Model'))
<a name="line181"></a>			{
<a name="line182"></a>				load_class('Model', 'core');
<a name="line183"></a>			}
<a name="line184"></a>
<a name="line185"></a>			require_once($mod_path.'models/'.$path.$model.EXT);
<a name="line186"></a>
<a name="line187"></a>			$model = ucfirst($model);
<a name="line188"></a>
<a name="line189"></a>			$CI->$name = new $model();
<a name="line190"></a>			$CI->$name->_assign_libraries();
<a name="line191"></a>
<a name="line192"></a>			$this->_ci_models[] = $name;
<a name="line193"></a>			return;
<a name="line194"></a>		}
<a name="line195"></a>		
<a name="line196"></a>		// couldn't find the model
<a name="line197"></a>		show_error('Unable to locate the model you have specified: '.$model);
<a name="line198"></a>	}
<a name="line199"></a>		
<a name="line200"></a>	// --------------------------------------------------------------------
<a name="line201"></a>	
<a name="line202"></a>	/**
<a name="line203"></a>	 * Database Loader
<a name="line204"></a>	 *
<a name="line205"></a>	 * @access	public
<a name="line206"></a>	 * @param	string	the DB credentials
<a name="line207"></a>	 * @param	bool	whether to return the DB object
<a name="line208"></a>	 * @param	bool	whether to enable active record (this allows us to override the config setting)
<a name="line209"></a>	 * @return	object
<a name="line210"></a>	 */	
<a name="line211"></a>	function database($params = '', $return = FALSE, $active_record = NULL)
<a name="line212"></a>	{
<a name="line213"></a>		// Grab the super object
<a name="line214"></a>		$CI =& get_instance();
<a name="line215"></a>		
<a name="line216"></a>		// Do we even need to load the database class?
<a name="line217"></a>		if (class_exists('CI_DB') AND $return == FALSE AND $active_record == NULL AND isset($CI->db) AND is_object($CI->db))
<a name="line218"></a>		{
<a name="line219"></a>			return FALSE;
<a name="line220"></a>		}	
<a name="line221"></a>	
<a name="line222"></a>		require_once(BASEPATH.'database/DB'.EXT);
<a name="line223"></a>
<a name="line224"></a>		if ($return === TRUE)
<a name="line225"></a>		{
<a name="line226"></a>			return DB($params, $active_record);
<a name="line227"></a>		}
<a name="line228"></a>		
<a name="line229"></a>		// Initialize the db variable.  Needed to prevent   
<a name="line230"></a>		// reference errors with some configurations
<a name="line231"></a>		$CI->db = '';
<a name="line232"></a>		
<a name="line233"></a>		// Load the DB class
<a name="line234"></a>		$CI->db =& DB($params, $active_record);	
<a name="line235"></a>		
<a name="line236"></a>		// Assign the DB object to any existing models
<a name="line237"></a>		$this->_ci_assign_to_models();
<a name="line238"></a>	}
<a name="line239"></a>	
<a name="line240"></a>	// --------------------------------------------------------------------
<a name="line241"></a>
<a name="line242"></a>	/**
<a name="line243"></a>	 * Load the Utilities Class
<a name="line244"></a>	 *
<a name="line245"></a>	 * @access	public
<a name="line246"></a>	 * @return	string		
<a name="line247"></a>	 */		
<a name="line248"></a>	function dbutil()
<a name="line249"></a>	{
<a name="line250"></a>		if ( ! class_exists('CI_DB'))
<a name="line251"></a>		{
<a name="line252"></a>			$this->database();
<a name="line253"></a>		}
<a name="line254"></a>		
<a name="line255"></a>		$CI =& get_instance();
<a name="line256"></a>
<a name="line257"></a>		// for backwards compatibility, load dbforge so we can extend dbutils off it
<a name="line258"></a>		// this use is deprecated and strongly discouraged
<a name="line259"></a>		$CI->load->dbforge();
<a name="line260"></a>	
<a name="line261"></a>		require_once(BASEPATH.'database/DB_utility'.EXT);
<a name="line262"></a>		require_once(BASEPATH.'database/drivers/'.$CI->db->dbdriver.'/'.$CI->db->dbdriver.'_utility'.EXT);
<a name="line263"></a>		$class = 'CI_DB_'.$CI->db->dbdriver.'_utility';
<a name="line264"></a>
<a name="line265"></a>		$CI->dbutil =& instantiate_class(new $class());
<a name="line266"></a>
<a name="line267"></a>		$CI->load->_ci_assign_to_models();
<a name="line268"></a>	}
<a name="line269"></a>	
<a name="line270"></a>	// --------------------------------------------------------------------
<a name="line271"></a>
<a name="line272"></a>	/**
<a name="line273"></a>	 * Load the Database Forge Class
<a name="line274"></a>	 *
<a name="line275"></a>	 * @access	public
<a name="line276"></a>	 * @return	string		
<a name="line277"></a>	 */		
<a name="line278"></a>	function dbforge()
<a name="line279"></a>	{
<a name="line280"></a>		if ( ! class_exists('CI_DB'))
<a name="line281"></a>		{
<a name="line282"></a>			$this->database();
<a name="line283"></a>		}
<a name="line284"></a>		
<a name="line285"></a>		$CI =& get_instance();
<a name="line286"></a>	
<a name="line287"></a>		require_once(BASEPATH.'database/DB_forge'.EXT);
<a name="line288"></a>		require_once(BASEPATH.'database/drivers/'.$CI->db->dbdriver.'/'.$CI->db->dbdriver.'_forge'.EXT);
<a name="line289"></a>		$class = 'CI_DB_'.$CI->db->dbdriver.'_forge';
<a name="line290"></a>
<a name="line291"></a>		$CI->dbforge = new $class();
<a name="line292"></a>		
<a name="line293"></a>		$CI->load->_ci_assign_to_models();
<a name="line294"></a>	}
<a name="line295"></a>	
<a name="line296"></a>	// --------------------------------------------------------------------
<a name="line297"></a>	
<a name="line298"></a>	/**
<a name="line299"></a>	 * Load View
<a name="line300"></a>	 *
<a name="line301"></a>	 * This function is used to load a "view" file.  It has three parameters:
<a name="line302"></a>	 *
<a name="line303"></a>	 * 1. The name of the "view" file to be included.
<a name="line304"></a>	 * 2. An associative array of data to be extracted for use in the view.
<a name="line305"></a>	 * 3. TRUE/FALSE - whether to return the data or load it.  In
<a name="line306"></a>	 * some cases it's advantageous to be able to return data so that
<a name="line307"></a>	 * a developer can process it in some way.
<a name="line308"></a>	 *
<a name="line309"></a>	 * @access	public
<a name="line310"></a>	 * @param	string
<a name="line311"></a>	 * @param	array
<a name="line312"></a>	 * @param	bool
<a name="line313"></a>	 * @return	void
<a name="line314"></a>	 */
<a name="line315"></a>	function view($view, $vars = array(), $return = FALSE)
<a name="line316"></a>	{
<a name="line317"></a>		return $this->_ci_load(array('_ci_view' => $view, '_ci_vars' => $this->_ci_object_to_array($vars), '_ci_return' => $return));
<a name="line318"></a>	}
<a name="line319"></a>	
<a name="line320"></a>	// --------------------------------------------------------------------
<a name="line321"></a>	
<a name="line322"></a>	/**
<a name="line323"></a>	 * Load File
<a name="line324"></a>	 *
<a name="line325"></a>	 * This is a generic file loader
<a name="line326"></a>	 *
<a name="line327"></a>	 * @access	public
<a name="line328"></a>	 * @param	string
<a name="line329"></a>	 * @param	bool
<a name="line330"></a>	 * @return	string
<a name="line331"></a>	 */
<a name="line332"></a>	function file($path, $return = FALSE)
<a name="line333"></a>	{
<a name="line334"></a>		return $this->_ci_load(array('_ci_path' => $path, '_ci_return' => $return));
<a name="line335"></a>	}
<a name="line336"></a>	
<a name="line337"></a>	// --------------------------------------------------------------------
<a name="line338"></a>	
<a name="line339"></a>	/**
<a name="line340"></a>	 * Set Variables
<a name="line341"></a>	 *
<a name="line342"></a>	 * Once variables are set they become available within
<a name="line343"></a>	 * the controller class and its "view" files.
<a name="line344"></a>	 *
<a name="line345"></a>	 * @access	public
<a name="line346"></a>	 * @param	array
<a name="line347"></a>	 * @return	void
<a name="line348"></a>	 */
<a name="line349"></a>	function vars($vars = array(), $val = '')
<a name="line350"></a>	{
<a name="line351"></a>		if ($val != '' AND is_string($vars))
<a name="line352"></a>		{
<a name="line353"></a>			$vars = array($vars => $val);
<a name="line354"></a>		}
<a name="line355"></a>	
<a name="line356"></a>		$vars = $this->_ci_object_to_array($vars);
<a name="line357"></a>	
<a name="line358"></a>		if (is_array($vars) AND count($vars) > 0)
<a name="line359"></a>		{
<a name="line360"></a>			foreach ($vars as $key => $val)
<a name="line361"></a>			{
<a name="line362"></a>				$this->_ci_cached_vars[$key] = $val;
<a name="line363"></a>			}
<a name="line364"></a>		}
<a name="line365"></a>	}
<a name="line366"></a>	
<a name="line367"></a>	// --------------------------------------------------------------------
<a name="line368"></a>	
<a name="line369"></a>	/**
<a name="line370"></a>	 * Load Helper
<a name="line371"></a>	 *
<a name="line372"></a>	 * This function loads the specified helper file.
<a name="line373"></a>	 *
<a name="line374"></a>	 * @access	public
<a name="line375"></a>	 * @param	mixed
<a name="line376"></a>	 * @return	void
<a name="line377"></a>	 */
<a name="line378"></a>	function helper($helpers = array())
<a name="line379"></a>	{	
<a name="line380"></a>		foreach ($this->_ci_prep_filename($helpers, '_helper') as $helper)
<a name="line381"></a>		{			
<a name="line382"></a>			if (isset($this->_ci_helpers[$helper]))
<a name="line383"></a>			{
<a name="line384"></a>				continue;
<a name="line385"></a>			}
<a name="line386"></a>
<a name="line387"></a>			$ext_helper = APPPATH.'helpers/'.config_item('subclass_prefix').$helper.EXT;
<a name="line388"></a>
<a name="line389"></a>			// Is this a helper extension request?			
<a name="line390"></a>			if (file_exists($ext_helper))
<a name="line391"></a>			{
<a name="line392"></a>				$base_helper = BASEPATH.'helpers/'.$helper.EXT;
<a name="line393"></a>				
<a name="line394"></a>				if ( ! file_exists($base_helper))
<a name="line395"></a>				{
<a name="line396"></a>					show_error('Unable to load the requested file: helpers/'.$helper.EXT);
<a name="line397"></a>				}
<a name="line398"></a>				
<a name="line399"></a>				include_once($ext_helper);
<a name="line400"></a>				include_once($base_helper);
<a name="line401"></a>				
<a name="line402"></a>				$this->_ci_helpers[$helper] = TRUE;
<a name="line403"></a>				log_message('debug', 'Helper loaded: '.$helper);
<a name="line404"></a>				continue;
<a name="line405"></a>			}
<a name="line406"></a>			
<a name="line407"></a>			// Try to load the helper
<a name="line408"></a>			foreach ($this->_ci_helper_paths as $path)
<a name="line409"></a>			{
<a name="line410"></a>				if (file_exists($path.'helpers/'.$helper.EXT))
<a name="line411"></a>				{ 
<a name="line412"></a>					include_once($path.'helpers/'.$helper.EXT);
<a name="line413"></a>
<a name="line414"></a>					$this->_ci_helpers[$helper] = TRUE;
<a name="line415"></a>					log_message('debug', 'Helper loaded: '.$helper);	
<a name="line416"></a>					break;
<a name="line417"></a>				}
<a name="line418"></a>			}
<a name="line419"></a>
<a name="line420"></a>			// unable to load the helper
<a name="line421"></a>			if ( ! isset($this->_ci_helpers[$helper]))
<a name="line422"></a>			{
<a name="line423"></a>				show_error('Unable to load the requested file: helpers/'.$helper.EXT);				
<a name="line424"></a>			}
<a name="line425"></a>		}		
<a name="line426"></a>	}
<a name="line427"></a>	
<a name="line428"></a>	// --------------------------------------------------------------------
<a name="line429"></a>	
<a name="line430"></a>	/**
<a name="line431"></a>	 * Load Helpers
<a name="line432"></a>	 *
<a name="line433"></a>	 * This is simply an alias to the above function in case the
<a name="line434"></a>	 * user has written the plural form of this function.
<a name="line435"></a>	 *
<a name="line436"></a>	 * @access	public
<a name="line437"></a>	 * @param	array
<a name="line438"></a>	 * @return	void
<a name="line439"></a>	 */
<a name="line440"></a>	function helpers($helpers = array())
<a name="line441"></a>	{
<a name="line442"></a>		$this->helper($helpers);
<a name="line443"></a>	}
<a name="line444"></a>	
<a name="line445"></a>	// --------------------------------------------------------------------
<a name="line446"></a>	
<a name="line447"></a>	/**
<a name="line448"></a>	 * Loads a language file
<a name="line449"></a>	 *
<a name="line450"></a>	 * @access	public
<a name="line451"></a>	 * @param	array
<a name="line452"></a>	 * @param	string
<a name="line453"></a>	 * @return	void
<a name="line454"></a>	 */
<a name="line455"></a>	function language($file = array(), $lang = '')
<a name="line456"></a>	{
<a name="line457"></a>		$CI =& get_instance();
<a name="line458"></a>
<a name="line459"></a>		if ( ! is_array($file))
<a name="line460"></a>		{
<a name="line461"></a>			$file = array($file);
<a name="line462"></a>		}
<a name="line463"></a>
<a name="line464"></a>		foreach ($file as $langfile)
<a name="line465"></a>		{	
<a name="line466"></a>			$CI->lang->load($langfile, $lang);
<a name="line467"></a>		}
<a name="line468"></a>	}
<a name="line469"></a>	
<a name="line470"></a>	// --------------------------------------------------------------------
<a name="line471"></a>	
<a name="line472"></a>	/**
<a name="line473"></a>	 * Loads a config file
<a name="line474"></a>	 *
<a name="line475"></a>	 * @access	public
<a name="line476"></a>	 * @param	string
<a name="line477"></a>	 * @return	void
<a name="line478"></a>	 */
<a name="line479"></a>	function config($file = '', $use_sections = FALSE, $fail_gracefully = FALSE)
<a name="line480"></a>	{			
<a name="line481"></a>		$CI =& get_instance();
<a name="line482"></a>		$CI->config->load($file, $use_sections, $fail_gracefully);
<a name="line483"></a>	}
<a name="line484"></a>
<a name="line485"></a>	// --------------------------------------------------------------------
<a name="line486"></a>
<a name="line487"></a>	/**
<a name="line488"></a>	 * Driver
<a name="line489"></a>	 *
<a name="line490"></a>	 * Loads a driver library
<a name="line491"></a>	 *
<a name="line492"></a>	 * @param	string	the name of the class
<a name="line493"></a>	 * @param	mixed	the optional parameters
<a name="line494"></a>	 * @param	string	an optional object name
<a name="line495"></a>	 * @return	void
<a name="line496"></a>	 */
<a name="line497"></a>	function driver($library = '', $params = NULL, $object_name = NULL)
<a name="line498"></a>	{
<a name="line499"></a>		if ( ! class_exists('CI_Driver_Library'))
<a name="line500"></a>		{
<a name="line501"></a>			// we aren't instantiating an object here, that'll be done by the Library itself
<a name="line502"></a>			require BASEPATH.'libraries/Driver'.EXT;
<a name="line503"></a>		}
<a name="line504"></a>		
<a name="line505"></a>		// We can save the loader some time since Drivers will *always* be in a subfolder,
<a name="line506"></a>		// and typically identically named to the library
<a name="line507"></a>		if ( ! strpos($library, '/'))
<a name="line508"></a>		{
<a name="line509"></a>			$library = ucfirst($library).'/'.$library;
<a name="line510"></a>		}
<a name="line511"></a>		
<a name="line512"></a>		return $this->library($library, $params, $object_name);
<a name="line513"></a>	}
<a name="line514"></a>
<a name="line515"></a>	// --------------------------------------------------------------------
<a name="line516"></a>	
<a name="line517"></a>	/**
<a name="line518"></a>	 * Add Package Path
<a name="line519"></a>	 *
<a name="line520"></a>	 * Prepends a parent path to the library, model, helper, and config path arrays
<a name="line521"></a>	 *
<a name="line522"></a>	 * @access	public
<a name="line523"></a>	 * @param	string
<a name="line524"></a>	 * @return	void
<a name="line525"></a>	 */
<a name="line526"></a>	function add_package_path($path)
<a name="line527"></a>	{
<a name="line528"></a>		array_unshift($this->_ci_library_paths, $path);
<a name="line529"></a>		array_unshift($this->_ci_model_paths, $path);
<a name="line530"></a>		array_unshift($this->_ci_helper_paths, $path);
<a name="line531"></a>		
<a name="line532"></a>		// Add config file path
<a name="line533"></a>		$config =& $this->_ci_get_component('config');
<a name="line534"></a>		array_unshift($config->_config_paths, $path);
<a name="line535"></a>	}
<a name="line536"></a>
<a name="line537"></a>	// --------------------------------------------------------------------
<a name="line538"></a>
<a name="line539"></a>	/**
<a name="line540"></a>	 * Remove Package Path
<a name="line541"></a>	 *
<a name="line542"></a>	 * Remove a path from the library, model, and helper path arrays if it exists
<a name="line543"></a>	 * If no path is provided, the most recently added path is removed.
<a name="line544"></a>	 *
<a name="line545"></a>	 * @access	public
<a name="line546"></a>	 * @param	type
<a name="line547"></a>	 * @return	type
<a name="line548"></a>	 */
<a name="line549"></a>	function remove_package_path($path = '', $remove_config_path = TRUE)
<a name="line550"></a>	{
<a name="line551"></a>		$config =& $this->_ci_get_component('config');
<a name="line552"></a>		
<a name="line553"></a>		if ($path == '')
<a name="line554"></a>		{
<a name="line555"></a>			$void = array_shift($this->_ci_library_paths);
<a name="line556"></a>			$void = array_shift($this->_ci_model_paths);
<a name="line557"></a>			$void = array_shift($this->_ci_helper_paths);
<a name="line558"></a>			$void = array_shift($config->_config_paths);
<a name="line559"></a>		}
<a name="line560"></a>		else
<a name="line561"></a>		{
<a name="line562"></a>			foreach (array('_ci_library_paths', '_ci_model_paths', '_ci_helper_paths') as $var)
<a name="line563"></a>			{
<a name="line564"></a>				if (($key = array_search($path, $this->{$var})) !== FALSE)
<a name="line565"></a>				{
<a name="line566"></a>					unset($this->{$var}[$key]);
<a name="line567"></a>				}
<a name="line568"></a>			}
<a name="line569"></a>			
<a name="line570"></a>			if (($key = array_search($path, $config->_config_paths)) !== FALSE)
<a name="line571"></a>			{
<a name="line572"></a>				unset($config->_config_paths[$key]);
<a name="line573"></a>			}
<a name="line574"></a>		}
<a name="line575"></a>		
<a name="line576"></a>		// make sure the application default paths are still in the array
<a name="line577"></a>		$this->_ci_library_paths = array_unique(array_merge($this->_ci_library_paths, array(APPPATH, BASEPATH)));
<a name="line578"></a>		$this->_ci_helper_paths = array_unique(array_merge($this->_ci_helper_paths, array(APPPATH, BASEPATH)));
<a name="line579"></a>		$this->_ci_model_paths = array_unique(array_merge($this->_ci_model_paths, array(APPPATH)));
<a name="line580"></a>		$config->_config_paths = array_unique(array_merge($config->_config_paths, array(APPPATH)));
<a name="line581"></a>	}
<a name="line582"></a>
<a name="line583"></a>	// --------------------------------------------------------------------
<a name="line584"></a>	
<a name="line585"></a>	/**
<a name="line586"></a>	 * Loader
<a name="line587"></a>	 *
<a name="line588"></a>	 * This function is used to load views and files.
<a name="line589"></a>	 * Variables are prefixed with _ci_ to avoid symbol collision with
<a name="line590"></a>	 * variables made available to view files
<a name="line591"></a>	 *
<a name="line592"></a>	 * @access	private
<a name="line593"></a>	 * @param	array
<a name="line594"></a>	 * @return	void
<a name="line595"></a>	 */
<a name="line596"></a>	function _ci_load($_ci_data)
<a name="line597"></a>	{
<a name="line598"></a>		// Set the default data variables
<a name="line599"></a>		foreach (array('_ci_view', '_ci_vars', '_ci_path', '_ci_return') as $_ci_val)
<a name="line600"></a>		{
<a name="line601"></a>			$$_ci_val = ( ! isset($_ci_data[$_ci_val])) ? FALSE : $_ci_data[$_ci_val];
<a name="line602"></a>		}
<a name="line603"></a>
<a name="line604"></a>		// Set the path to the requested file
<a name="line605"></a>		if ($_ci_path == '')
<a name="line606"></a>		{
<a name="line607"></a>			$_ci_ext = pathinfo($_ci_view, PATHINFO_EXTENSION);
<a name="line608"></a>			$_ci_file = ($_ci_ext == '') ? $_ci_view.EXT : $_ci_view;
<a name="line609"></a>			$_ci_path = $this->_ci_view_path.$_ci_file;
<a name="line610"></a>		}
<a name="line611"></a>		else
<a name="line612"></a>		{
<a name="line613"></a>			$_ci_x = explode('/', $_ci_path);
<a name="line614"></a>			$_ci_file = end($_ci_x);
<a name="line615"></a>		}
<a name="line616"></a>		
<a name="line617"></a>		if ( ! file_exists($_ci_path))
<a name="line618"></a>		{
<a name="line619"></a>			show_error('Unable to load the requested file: '.$_ci_file);
<a name="line620"></a>		}
<a name="line621"></a>	
<a name="line622"></a>		// This allows anything loaded using $this->load (views, files, etc.)
<a name="line623"></a>		// to become accessible from within the Controller and Model functions.
<a name="line624"></a>		// Only needed when running PHP 5
<a name="line625"></a>		
<a name="line626"></a>		if ($this->_ci_is_instance())
<a name="line627"></a>		{
<a name="line628"></a>			$_ci_CI =& get_instance();
<a name="line629"></a>			foreach (get_object_vars($_ci_CI) as $_ci_key => $_ci_var)
<a name="line630"></a>			{
<a name="line631"></a>				if ( ! isset($this->$_ci_key))
<a name="line632"></a>				{
<a name="line633"></a>					$this->$_ci_key =& $_ci_CI->$_ci_key;
<a name="line634"></a>				}
<a name="line635"></a>			}
<a name="line636"></a>		}
<a name="line637"></a>
<a name="line638"></a>		/*
<a name="line639"></a>		 * Extract and cache variables
<a name="line640"></a>		 *
<a name="line641"></a>		 * You can either set variables using the dedicated $this->load_vars()
<a name="line642"></a>		 * function or via the second parameter of this function. We'll merge
<a name="line643"></a>		 * the two types and cache them so that views that are embedded within
<a name="line644"></a>		 * other views can have access to these variables.
<a name="line645"></a>		 */	
<a name="line646"></a>		if (is_array($_ci_vars))
<a name="line647"></a>		{
<a name="line648"></a>			$this->_ci_cached_vars = array_merge($this->_ci_cached_vars, $_ci_vars);
<a name="line649"></a>		}
<a name="line650"></a>		extract($this->_ci_cached_vars);
<a name="line651"></a>				
<a name="line652"></a>		/*
<a name="line653"></a>		 * Buffer the output
<a name="line654"></a>		 *
<a name="line655"></a>		 * We buffer the output for two reasons:
<a name="line656"></a>		 * 1. Speed. You get a significant speed boost.
<a name="line657"></a>		 * 2. So that the final rendered template can be
<a name="line658"></a>		 * post-processed by the output class.  Why do we
<a name="line659"></a>		 * need post processing?  For one thing, in order to
<a name="line660"></a>		 * show the elapsed page load time.  Unless we
<a name="line661"></a>		 * can intercept the content right before it's sent to
<a name="line662"></a>		 * the browser and then stop the timer it won't be accurate.
<a name="line663"></a>		 */
<a name="line664"></a>		ob_start();
<a name="line665"></a>				
<a name="line666"></a>		// If the PHP installation does not support short tags we'll
<a name="line667"></a>		// do a little string replacement, changing the short tags
<a name="line668"></a>		// to standard PHP echo statements.
<a name="line669"></a>		
<a name="line670"></a>		if ((bool) @ini_get('short_open_tag') === FALSE AND config_item('rewrite_short_tags') == TRUE)
<a name="line671"></a>		{
<a name="line672"></a>			echo eval('?>'.preg_replace("/;*\s*\?>/", "; ?>", str_replace('<?=', '<?php echo ', file_get_contents($_ci_path))));
<a name="line673"></a>		}
<a name="line674"></a>		else
<a name="line675"></a>		{
<a name="line676"></a>			include($_ci_path); // include() vs include_once() allows for multiple views with the same name
<a name="line677"></a>		}
<a name="line678"></a>		
<a name="line679"></a>		log_message('debug', 'File loaded: '.$_ci_path);
<a name="line680"></a>		
<a name="line681"></a>		// Return the file data if requested
<a name="line682"></a>		if ($_ci_return === TRUE)
<a name="line683"></a>		{		
<a name="line684"></a>			$buffer = ob_get_contents();
<a name="line685"></a>			@ob_end_clean();
<a name="line686"></a>			return $buffer;
<a name="line687"></a>		}
<a name="line688"></a>
<a name="line689"></a>		/*
<a name="line690"></a>		 * Flush the buffer... or buff the flusher?
<a name="line691"></a>		 *
<a name="line692"></a>		 * In order to permit views to be nested within
<a name="line693"></a>		 * other views, we need to flush the content back out whenever
<a name="line694"></a>		 * we are beyond the first level of output buffering so that
<a name="line695"></a>		 * it can be seen and included properly by the first included
<a name="line696"></a>		 * template and any subsequent ones. Oy!
<a name="line697"></a>		 *
<a name="line698"></a>		 */	
<a name="line699"></a>		if (ob_get_level() > $this->_ci_ob_level + 1)
<a name="line700"></a>		{
<a name="line701"></a>			ob_end_flush();
<a name="line702"></a>		}
<a name="line703"></a>		else
<a name="line704"></a>		{
<a name="line705"></a>			// PHP 4 requires that we use a global
<a name="line706"></a>			global $OUT;
<a name="line707"></a>			$OUT->append_output(ob_get_contents());
<a name="line708"></a>			@ob_end_clean();
<a name="line709"></a>		}
<a name="line710"></a>	}
<a name="line711"></a>
<a name="line712"></a>	// --------------------------------------------------------------------
<a name="line713"></a>
<a name="line714"></a>	/**
<a name="line715"></a>	 * Load class
<a name="line716"></a>	 *
<a name="line717"></a>	 * This function loads the requested class.
<a name="line718"></a>	 *
<a name="line719"></a>	 * @access	private
<a name="line720"></a>	 * @param 	string	the item that is being loaded
<a name="line721"></a>	 * @param	mixed	any additional parameters
<a name="line722"></a>	 * @param	string	an optional object name
<a name="line723"></a>	 * @return 	void
<a name="line724"></a>	 */
<a name="line725"></a>	function _ci_load_class($class, $params = NULL, $object_name = NULL)
<a name="line726"></a>	{	
<a name="line727"></a>		// Get the class name, and while we're at it trim any slashes.  
<a name="line728"></a>		// The directory path can be included as part of the class name, 
<a name="line729"></a>		// but we don't want a leading slash
<a name="line730"></a>		$class = str_replace(EXT, '', trim($class, '/'));
<a name="line731"></a>	
<a name="line732"></a>		// Was the path included with the class name?
<a name="line733"></a>		// We look for a slash to determine this
<a name="line734"></a>		$subdir = '';
<a name="line735"></a>		if (($last_slash = strrpos($class, '/')) !== FALSE)
<a name="line736"></a>		{
<a name="line737"></a>			// Extract the path
<a name="line738"></a>			$subdir = substr($class, 0, $last_slash + 1);
<a name="line739"></a>			
<a name="line740"></a>			// Get the filename from the path
<a name="line741"></a>			$class = substr($class, $last_slash + 1);
<a name="line742"></a>		}
<a name="line743"></a>
<a name="line744"></a>		// We'll test for both lowercase and capitalized versions of the file name
<a name="line745"></a>		foreach (array(ucfirst($class), strtolower($class)) as $class)
<a name="line746"></a>		{
<a name="line747"></a>			$subclass = APPPATH.'libraries/'.$subdir.config_item('subclass_prefix').$class.EXT;
<a name="line748"></a>
<a name="line749"></a>			// Is this a class extension request?			
<a name="line750"></a>			if (file_exists($subclass))
<a name="line751"></a>			{
<a name="line752"></a>				$baseclass = BASEPATH.'libraries/'.ucfirst($class).EXT;
<a name="line753"></a>				
<a name="line754"></a>				if ( ! file_exists($baseclass))
<a name="line755"></a>				{
<a name="line756"></a>					log_message('error', "Unable to load the requested class: ".$class);
<a name="line757"></a>					show_error("Unable to load the requested class: ".$class);
<a name="line758"></a>				}
<a name="line759"></a>
<a name="line760"></a>				// Safety:  Was the class already loaded by a previous call?
<a name="line761"></a>				if (in_array($subclass, $this->_ci_loaded_files))
<a name="line762"></a>				{
<a name="line763"></a>					// Before we deem this to be a duplicate request, let's see
<a name="line764"></a>					// if a custom object name is being supplied.  If so, we'll
<a name="line765"></a>					// return a new instance of the object
<a name="line766"></a>					if ( ! is_null($object_name))
<a name="line767"></a>					{
<a name="line768"></a>						$CI =& get_instance();
<a name="line769"></a>						if ( ! isset($CI->$object_name))
<a name="line770"></a>						{
<a name="line771"></a>							return $this->_ci_init_class($class, config_item('subclass_prefix'), $params, $object_name);			
<a name="line772"></a>						}
<a name="line773"></a>					}
<a name="line774"></a>					
<a name="line775"></a>					$is_duplicate = TRUE;
<a name="line776"></a>					log_message('debug', $class." class already loaded. Second attempt ignored.");
<a name="line777"></a>					return;
<a name="line778"></a>				}
<a name="line779"></a>	
<a name="line780"></a>				include_once($baseclass);				
<a name="line781"></a>				include_once($subclass);
<a name="line782"></a>				$this->_ci_loaded_files[] = $subclass;
<a name="line783"></a>	
<a name="line784"></a>				return $this->_ci_init_class($class, config_item('subclass_prefix'), $params, $object_name);			
<a name="line785"></a>			}
<a name="line786"></a>		
<a name="line787"></a>			// Lets search for the requested library file and load it.
<a name="line788"></a>			$is_duplicate = FALSE;
<a name="line789"></a>			foreach ($this->_ci_library_paths as $path)
<a name="line790"></a>			{
<a name="line791"></a>				$filepath = $path.'libraries/'.$subdir.$class.EXT;
<a name="line792"></a>
<a name="line793"></a>				// Does the file exist?  No?  Bummer...
<a name="line794"></a>				if ( ! file_exists($filepath))
<a name="line795"></a>				{
<a name="line796"></a>					continue;
<a name="line797"></a>				}
<a name="line798"></a>				
<a name="line799"></a>				// Safety:  Was the class already loaded by a previous call?
<a name="line800"></a>				if (in_array($filepath, $this->_ci_loaded_files))
<a name="line801"></a>				{
<a name="line802"></a>					// Before we deem this to be a duplicate request, let's see
<a name="line803"></a>					// if a custom object name is being supplied.  If so, we'll
<a name="line804"></a>					// return a new instance of the object
<a name="line805"></a>					if ( ! is_null($object_name))
<a name="line806"></a>					{
<a name="line807"></a>						$CI =& get_instance();
<a name="line808"></a>						if ( ! isset($CI->$object_name))
<a name="line809"></a>						{
<a name="line810"></a>							return $this->_ci_init_class($class, '', $params, $object_name);
<a name="line811"></a>						}
<a name="line812"></a>					}
<a name="line813"></a>				
<a name="line814"></a>					$is_duplicate = TRUE;
<a name="line815"></a>					log_message('debug', $class." class already loaded. Second attempt ignored.");
<a name="line816"></a>					return;
<a name="line817"></a>				}
<a name="line818"></a>				
<a name="line819"></a>				include_once($filepath);
<a name="line820"></a>				$this->_ci_loaded_files[] = $filepath;
<a name="line821"></a>				return $this->_ci_init_class($class, '', $params, $object_name);				
<a name="line822"></a>			}
<a name="line823"></a>
<a name="line824"></a>		} // END FOREACH
<a name="line825"></a>
<a name="line826"></a>		// One last attempt.  Maybe the library is in a subdirectory, but it wasn't specified?
<a name="line827"></a>		if ($subdir == '')
<a name="line828"></a>		{
<a name="line829"></a>			$path = strtolower($class).'/'.$class;
<a name="line830"></a>			return $this->_ci_load_class($path, $params);
<a name="line831"></a>		}
<a name="line832"></a>		
<a name="line833"></a>		// If we got this far we were unable to find the requested class.
<a name="line834"></a>		// We do not issue errors if the load call failed due to a duplicate request
<a name="line835"></a>		if ($is_duplicate == FALSE)
<a name="line836"></a>		{
<a name="line837"></a>			log_message('error', "Unable to load the requested class: ".$class);
<a name="line838"></a>			show_error("Unable to load the requested class: ".$class);
<a name="line839"></a>		}
<a name="line840"></a>	}
<a name="line841"></a>	
<a name="line842"></a>	// --------------------------------------------------------------------
<a name="line843"></a>
<a name="line844"></a>	/**
<a name="line845"></a>	 * Instantiates a class
<a name="line846"></a>	 *
<a name="line847"></a>	 * @access	private
<a name="line848"></a>	 * @param	string
<a name="line849"></a>	 * @param	string
<a name="line850"></a>	 * @param	string	an optional object name
<a name="line851"></a>	 * @return	null
<a name="line852"></a>	 */
<a name="line853"></a>	function _ci_init_class($class, $prefix = '', $config = FALSE, $object_name = NULL)
<a name="line854"></a>	{	
<a name="line855"></a>		// Is there an associated config file for this class?  Note: these should always be lowercase
<a name="line856"></a>		if ($config === NULL)
<a name="line857"></a>		{
<a name="line858"></a>			// We test for both uppercase and lowercase, for servers that
<a name="line859"></a>			// are case-sensitive with regard to file names
<a name="line860"></a>			if (file_exists(APPPATH.'config/'.strtolower($class).EXT))
<a name="line861"></a>			{
<a name="line862"></a>				include_once(APPPATH.'config/'.strtolower($class).EXT);
<a name="line863"></a>			}			
<a name="line864"></a>			elseif (file_exists(APPPATH.'config/'.ucfirst(strtolower($class)).EXT))
<a name="line865"></a>			{
<a name="line866"></a>				include_once(APPPATH.'config/'.ucfirst(strtolower($class)).EXT);
<a name="line867"></a>			}
<a name="line868"></a>		}
<a name="line869"></a>		
<a name="line870"></a>		if ($prefix == '')
<a name="line871"></a>		{			
<a name="line872"></a>			if (class_exists('CI_'.$class)) 
<a name="line873"></a>			{
<a name="line874"></a>				$name = 'CI_'.$class;
<a name="line875"></a>			}
<a name="line876"></a>			elseif (class_exists(config_item('subclass_prefix').$class)) 
<a name="line877"></a>			{
<a name="line878"></a>				$name = config_item('subclass_prefix').$class;
<a name="line879"></a>			}
<a name="line880"></a>			else
<a name="line881"></a>			{
<a name="line882"></a>				$name = $class;
<a name="line883"></a>			}
<a name="line884"></a>		}
<a name="line885"></a>		else
<a name="line886"></a>		{
<a name="line887"></a>			$name = $prefix.$class;
<a name="line888"></a>		}
<a name="line889"></a>		
<a name="line890"></a>		// Is the class name valid?
<a name="line891"></a>		if ( ! class_exists($name))
<a name="line892"></a>		{
<a name="line893"></a>			log_message('error', "Non-existent class: ".$name);
<a name="line894"></a>			show_error("Non-existent class: ".$class);
<a name="line895"></a>		}
<a name="line896"></a>		
<a name="line897"></a>		// Set the variable name we will assign the class to
<a name="line898"></a>		// Was a custom class name supplied?  If so we'll use it
<a name="line899"></a>		$class = strtolower($class);
<a name="line900"></a>		
<a name="line901"></a>		if (is_null($object_name))
<a name="line902"></a>		{
<a name="line903"></a>			$classvar = ( ! isset($this->_ci_varmap[$class])) ? $class : $this->_ci_varmap[$class];
<a name="line904"></a>		}
<a name="line905"></a>		else
<a name="line906"></a>		{
<a name="line907"></a>			$classvar = $object_name;
<a name="line908"></a>		}
<a name="line909"></a>
<a name="line910"></a>		// Save the class name and object name		
<a name="line911"></a>		$this->_ci_classes[$class] = $classvar;
<a name="line912"></a>
<a name="line913"></a>		// Instantiate the class		
<a name="line914"></a>		$CI =& get_instance();
<a name="line915"></a>		if ($config !== NULL)
<a name="line916"></a>		{
<a name="line917"></a>			$CI->$classvar = new $name($config);
<a name="line918"></a>		}
<a name="line919"></a>		else
<a name="line920"></a>		{		
<a name="line921"></a>			$CI->$classvar = new $name;
<a name="line922"></a>		}	
<a name="line923"></a>	} 	
<a name="line924"></a>	
<a name="line925"></a>	// --------------------------------------------------------------------
<a name="line926"></a>	
<a name="line927"></a>	/**
<a name="line928"></a>	 * Autoloader
<a name="line929"></a>	 *
<a name="line930"></a>	 * The config/autoload.php file contains an array that permits sub-systems,
<a name="line931"></a>	 * libraries, and helpers to be loaded automatically.
<a name="line932"></a>	 *
<a name="line933"></a>	 * @access	private
<a name="line934"></a>	 * @param	array
<a name="line935"></a>	 * @return	void
<a name="line936"></a>	 */
<a name="line937"></a>	function _ci_autoloader()
<a name="line938"></a>	{	
<a name="line939"></a>		include_once(APPPATH.'config/autoload'.EXT);
<a name="line940"></a>		
<a name="line941"></a>		if ( ! isset($autoload))
<a name="line942"></a>		{
<a name="line943"></a>			return FALSE;
<a name="line944"></a>		}
<a name="line945"></a>		Console::logSpeed('Getting config...');
<a name="line946"></a>		// Load any custom config file
<a name="line947"></a>		if (count($autoload['config']) > 0)
<a name="line948"></a>		{			
<a name="line949"></a>			$CI =& get_instance();
<a name="line950"></a>			foreach ($autoload['config'] as $key => $val)
<a name="line951"></a>			{
<a name="line952"></a>				$CI->config->load($val);
<a name="line953"></a>			}
<a name="line954"></a>		}		
<a name="line955"></a>		Console::logSpeed('Getting config...done');
<a name="line956"></a>		
<a name="line957"></a>		Console::logSpeed('Getting helpers...');
<a name="line958"></a>
<a name="line959"></a>		// Autoload helpers and languages
<a name="line960"></a>		foreach (array('helper', 'language') as $type)
<a name="line961"></a>		{			
<a name="line962"></a>			if (isset($autoload[$type]) AND count($autoload[$type]) > 0)
<a name="line963"></a>			{
<a name="line964"></a>				$this->$type($autoload[$type]);
<a name="line965"></a>			}		
<a name="line966"></a>		}
<a name="line967"></a>		Console::logSpeed('Getting helpers...done');
<a name="line968"></a>
<a name="line969"></a>		// A little tweak to remain backward compatible
<a name="line970"></a>		// The $autoload['core'] item was deprecated
<a name="line971"></a>		if ( ! isset($autoload['libraries']) AND isset($autoload['core']))
<a name="line972"></a>		{
<a name="line973"></a>			$autoload['libraries'] = $autoload['core'];
<a name="line974"></a>		}
<a name="line975"></a>		Console::logSpeed('Getting libraries...');
<a name="line976"></a>		// Load libraries
<a name="line977"></a>		if (isset($autoload['libraries']) AND count($autoload['libraries']) > 0)
<a name="line978"></a>		{
<a name="line979"></a>			// Load the database driver.
<a name="line980"></a>			if (in_array('database', $autoload['libraries']))
<a name="line981"></a>			{
<a name="line982"></a>				$this->database();
<a name="line983"></a>				$autoload['libraries'] = array_diff($autoload['libraries'], array('database'));
<a name="line984"></a>			}
<a name="line985"></a>		
<a name="line986"></a>			// Load all other libraries
<a name="line987"></a>			foreach ($autoload['libraries'] as $item)
<a name="line988"></a>			{
<a name="line989"></a>				Console::logSpeed('Getting '.$item.'...');
<a name="line990"></a>				$this->library($item);
<a name="line991"></a>				Console::logSpeed('Getting '.$item.'...done.');
<a name="line992"></a>			}
<a name="line993"></a>		}		
<a name="line994"></a>		
<a name="line995"></a>		Console::logSpeed('Getting libraries...done');
<a name="line996"></a>
<a name="line997"></a>
<a name="line998"></a>		// Autoload models
<a name="line999"></a>		if (isset($autoload['model']))
<a name="line1000"></a>		{
<a name="line1001"></a>			$this->model($autoload['model']);
<a name="line1002"></a>		}
<a name="line1003"></a>
<a name="line1004"></a>	}
<a name="line1005"></a>	
<a name="line1006"></a>	// --------------------------------------------------------------------
<a name="line1007"></a>
<a name="line1008"></a>	/**
<a name="line1009"></a>	 * Assign to Models
<a name="line1010"></a>	 *
<a name="line1011"></a>	 * Makes sure that anything loaded by the loader class (libraries, etc.)
<a name="line1012"></a>	 * will be available to models, if any exist.
<a name="line1013"></a>	 *
<a name="line1014"></a>	 * @access	private
<a name="line1015"></a>	 * @param	object
<a name="line1016"></a>	 * @return	array
<a name="line1017"></a>	 */
<a name="line1018"></a>	function _ci_assign_to_models()
<a name="line1019"></a>	{
<a name="line1020"></a>		if (count($this->_ci_models) == 0)
<a name="line1021"></a>		{
<a name="line1022"></a>			return;
<a name="line1023"></a>		}
<a name="line1024"></a>	
<a name="line1025"></a>		foreach($this->_ci_models as $model)
<a name="line1026"></a>		{
<a name="line1027"></a>			$model = $this->_ci_get_component($model);
<a name="line1028"></a>			$model->_assign_libraries();
<a name="line1029"></a>		}
<a name="line1030"></a>	}  	
<a name="line1031"></a>
<a name="line1032"></a>	// --------------------------------------------------------------------
<a name="line1033"></a>
<a name="line1034"></a>	/**
<a name="line1035"></a>	 * Object to Array
<a name="line1036"></a>	 *
<a name="line1037"></a>	 * Takes an object as input and converts the class variables to array key/vals
<a name="line1038"></a>	 *
<a name="line1039"></a>	 * @access	private
<a name="line1040"></a>	 * @param	object
<a name="line1041"></a>	 * @return	array
<a name="line1042"></a>	 */
<a name="line1043"></a>	function _ci_object_to_array($object)
<a name="line1044"></a>	{
<a name="line1045"></a>		return (is_object($object)) ? get_object_vars($object) : $object;
<a name="line1046"></a>	}
<a name="line1047"></a>
<a name="line1048"></a>	// --------------------------------------------------------------------
<a name="line1049"></a>
<a name="line1050"></a>	/**
<a name="line1051"></a>	 * Determines whether we should use the CI instance or $this
<a name="line1052"></a>	 * @PHP4
<a name="line1053"></a>	 * 
<a name="line1054"></a>	 * @access	private
<a name="line1055"></a>	 * @return	bool
<a name="line1056"></a>	 */
<a name="line1057"></a>	function _ci_is_instance()
<a name="line1058"></a>	{
<a name="line1059"></a>		if (is_php('5.0.0') == TRUE)
<a name="line1060"></a>		{
<a name="line1061"></a>			return TRUE;
<a name="line1062"></a>		}
<a name="line1063"></a>	
<a name="line1064"></a>		global $CI;
<a name="line1065"></a>		return (is_object($CI)) ? TRUE : FALSE;
<a name="line1066"></a>	}
<a name="line1067"></a>	
<a name="line1068"></a>	// --------------------------------------------------------------------
<a name="line1069"></a>
<a name="line1070"></a>	/**
<a name="line1071"></a>	 * Get a reference to a specific library or model
<a name="line1072"></a>	 *
<a name="line1073"></a>	 * @access	private
<a name="line1074"></a>	 * @return	bool
<a name="line1075"></a>	 */
<a name="line1076"></a>	function &_ci_get_component($component)
<a name="line1077"></a>	{
<a name="line1078"></a>		if ($this->_ci_is_instance())
<a name="line1079"></a>		{
<a name="line1080"></a>			$CI =& get_instance();
<a name="line1081"></a>			return $CI->$component;
<a name="line1082"></a>		}
<a name="line1083"></a>		else
<a name="line1084"></a>		{
<a name="line1085"></a>			return $this->$component;
<a name="line1086"></a>		}
<a name="line1087"></a>	}
<a name="line1088"></a>
<a name="line1089"></a>	// --------------------------------------------------------------------
<a name="line1090"></a>	
<a name="line1091"></a>	/**
<a name="line1092"></a>	 * Prep filename
<a name="line1093"></a>	 *
<a name="line1094"></a>	 * This function preps the name of various items to make loading them more reliable.
<a name="line1095"></a>	 *
<a name="line1096"></a>	 * @access	private
<a name="line1097"></a>	 * @param	mixed
<a name="line1098"></a>	 * @return	array
<a name="line1099"></a>	 */
<a name="line1100"></a>	function _ci_prep_filename($filename, $extension)
<a name="line1101"></a>	{
<a name="line1102"></a>		if ( ! is_array($filename))
<a name="line1103"></a>		{			
<a name="line1104"></a>			return array(strtolower(str_replace(EXT, '', str_replace($extension, '', $filename)).$extension));	
<a name="line1105"></a>		}
<a name="line1106"></a>		else
<a name="line1107"></a>		{
<a name="line1108"></a>			foreach ($filename as $key => $val)
<a name="line1109"></a>			{
<a name="line1110"></a>				$filename[$key] = strtolower(str_replace(EXT, '', str_replace($extension, '', $val)).$extension);	
<a name="line1111"></a>			}
<a name="line1112"></a>			
<a name="line1113"></a>			return $filename;
<a name="line1114"></a>		}
<a name="line1115"></a>	}
<a name="line1116"></a>	
<a name="line1117"></a>
<a name="line1118"></a>}
<a name="line1119"></a>
<a name="line1120"></a>/* End of file Loader.php */
<a name="line1121"></a>/* Location: ./system/core/Loader.php */</pre>
<div class="header">
<h1>GiftFlow API</h1>
<ul>
<li><a href="../../overview-summary.html">Overview</a></li>
<li>Package</li><li>Class</li><li>Tree</li><li><a href="../../overview-files.html">Files</a></li>
<li><a href="../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../index-all.html">Index</a></li>
</ul>
</div>

<div class="small_links">
<a href="../../index.html" target="_top">Frames</a>
<a href="../../source/core/loader.php.html" target="_top">No frames</a>
</div>
<hr>

<p id="footer">This document was generated by <a href="http://peej.github.com/phpdoctor/">PHPDoctor: The PHP Documentation Creator</a></p>

</body>

</html>